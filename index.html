<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arii MiniApp</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- LibTL Ads -->
  <script src='//libtl.com/sdk.js' data-zone='10580493' data-sdk='show_10580493'></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--tg-theme-bg-color, #0e0f12);
      color: var(--tg-theme-text-color, #ffffff);
    }

    .header {
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .title {
      font-size: 18px;
      font-weight: bold;
    }

    .subtitle {
      font-size: 13px;
      opacity: 0.7;
      margin-top: 4px;
    }

    .container {
      padding: 16px;
      max-width: 600px;
      margin: auto;
    }

    .card {
      background: var(--tg-theme-secondary-bg-color, #17181d);
      border-radius: 16px;
      padding: 16px;
      margin-top: 14px;
      box-shadow: 0px 6px 14px rgba(0,0,0,0.25);
    }

    .card h2 {
      margin: 0;
      font-size: 16px;
      margin-bottom: 6px;
    }

    .card p {
      margin: 0;
      font-size: 13px;
      opacity: 0.75;
      line-height: 1.6;
    }

    .btn {
      width: 100%;
      margin-top: 14px;
      padding: 14px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      background: var(--tg-theme-button-color, #2ea6ff);
      color: var(--tg-theme-button-text-color, #ffffff);
      transition: 0.2s;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      opacity: 0.9;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--tg-theme-secondary-bg-color, #17181d);
      border-top: 1px solid rgba(255,255,255,0.08);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
    }

    .footer a {
      text-decoration: none;
      color: var(--tg-theme-hint-color, #aaaaaa);
      font-size: 12px;
      text-align: center;
      flex: 1;
    }

    .footer a.active {
      color: var(--tg-theme-link-color, #2ea6ff);
      font-weight: bold;
    }

    .footer a div {
      font-size: 18px;
      margin-bottom: 2px;
    }

    .space {
      height: 80px;
    }
  </style>
</head>

<body>

  <div class="header">
    <div class="title">Arii MiniApp</div>
    <div class="subtitle">Reward Ads System</div>
  </div>

  <div class="container">

    <div class="card">
      <h2>üéÅ Reward Ads</h2>
      <p>
        Tonton iklan sampai selesai untuk mendapatkan reward.
        Reward diberikan otomatis.
      </p>

      <button id="btn" class="btn">üé• Tonton Iklan</button>

      <div class="status">
        <div id="statusText">Status: Ready</div>
        <div id="statusIcon">‚úÖ</div>
      </div>
    </div>

    <div class="card">
      <h2>üìå Info</h2>
      <p>
        Jika iklan tidak tersedia, coba lagi beberapa saat atau ganti jaringan.
      </p>
    </div>

    <div class="space"></div>
  </div>

  <div class="footer">
    <a href="index.html" class="active">
      <div>üè†</div>
      Home
    </a>
    <a href="about.html">
      <div>‚ÑπÔ∏è</div>
      About
    </a>
    <a href="privacy.html">
      <div>üîí</div>
      Privacy
    </a>
  </div>

  <script>
    // Telegram init
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }

    const btn = document.getElementById("btn");
    const statusText = document.getElementById("statusText");
    const statusIcon = document.getElementById("statusIcon");

    const API_URL = "https://telegram-miniapp4.vercel.app";
    const telegram_id = Telegram.WebApp?.initDataUnsafe?.user?.id;

    function setStatus(text, icon) {
      statusText.innerText = "Status: " + text;
      statusIcon.innerText = icon;
    }

    async function claimReward() {
      try {
        const res = await fetch(`${API_URL}/api/claim`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ telegram_id })
        });

        const data = await res.json();

        if (!res.ok) {
          if (data.wait) {
            alert("Cooldown! Tunggu " + data.wait + " detik.");
          } else {
            alert("Claim gagal: " + (data.error || "Unknown error"));
          }
          return null;
        }

        return data;
      } catch (err) {
        console.log("Claim Error:", err);
        alert("Server error saat claim!");
        return null;
      }
    }

    btn.onclick = function () {
      if (!telegram_id) {
        alert("Telegram ID tidak tersedia.");
        return;
      }

      // cek SDK LibTL
      if (!window.show_10580493) {
        setStatus("Ads script gagal load", "‚ö†Ô∏è");
        alert("show_10580493 tidak tersedia. SDK LibTL gagal load.");
        return;
      }

      btn.disabled = true;
      setStatus("Loading ad...", "‚è≥");

      // tampilkan iklan LibTL
      show_10580493()
        .then(async () => {
          setStatus("Claiming reward...", "üí∞");

          const claim = await claimReward();

          if (claim) {
            setStatus("Reward sukses!", "üéâ");

            if (window.Telegram && Telegram.WebApp) {
              Telegram.WebApp.HapticFeedback.notificationOccurred("success");
            }

            alert("Reward berhasil! +" + claim.reward + " coin\nBalance: " + claim.balance);
          } else {
            setStatus("Claim gagal", "‚ùå");
          }
        })
        .catch(e => {
          console.log("Ads Error:", e);
          setStatus("Iklan tidak tersedia / dibatalkan", "‚ùå");

          if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.HapticFeedback.notificationOccurred("error");
          }

          alert("Iklan dibatalkan atau tidak tersedia.");
        })
        .finally(() => {
          btn.disabled = false;
        });
    };
  </script>

</body>
</html>
